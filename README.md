# Прозрачный шлюз с SOCKS-проксированием

Шлюз для перенаправления трафика через SOCKS-прокси на основе списка доменов. Решение для организации безопасного доступа и мониторинга сетевой активности.

## Особенности

- Автоматическое перенаправление трафика для заданных доменов
- Поддержка различных типов WAN-подключений:
  - DHCP
  - Статический IP
  - PPPoE
  - L2TP
- Динамическое обновление IP-адресов доменов
- Интеграция с SOCKS5 прокси
- Логирование всех операций
- Модульная архитектура с поддержкой параметров командной строки

## Требования

- Сервер/ПК с Linux (рекомендуется Ubuntu 22.04+)
- Два сетевых интерфейса (LAN/WAN)

## Быстрый старт

### Установка
1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/transparent-proxy-gateway.git
cd transparent-proxy-gateway
```

2. Запустите установку:
```bash
chmod +x gateway.sh
sudo ./gateway.sh --install
```

3. Следуйте инструкциям на экране:
   - Выберите LAN и WAN интерфейсы
   - Настройте тип WAN-подключения
   - Укажите параметры прокси при запросе

### Конфигурация

1. Добавьте домены в `domains.txt`:
```bash
sudo nano domains.txt
```

2. Настройте прокси в `config/redsocks.conf`:
```ini
redsocks {
    ip = ваш.proxy.server;  # Адрес SOCKS-прокси
    port = 1080;            # Порт прокси
    type = socks5;
}
```

3. Примените изменения:
```bash
sudo systemctl restart redsocks
```

## Использование

### Основные команды

| Команда                     | Описание                          |
|-----------------------------|-----------------------------------|
| `sudo ./gateway.sh --install` | Полная установка системы          |
| `sudo ./gateway.sh --wan`     | Перенастройка WAN-подключения     |
| `sudo ./gateway.sh --update`  | Принудительное обновление IP      |
| `sudo ./gateway.sh --help`    | Показать справку                  |

### Примеры

1. Обновить список IP-адресов:
```bash
sudo ./gateway.sh --update
```

2. Изменить тип WAN-подключения:
```bash
sudo ./gateway.sh --wan
```

3. Проверить статус сервисов:
```bash
systemctl status redsocks
```

проверить добавленые ip адреса доменов
ipset list proxy_domains

## Структура проекта

```
/transparent-proxy-gateway/
├── gateway.sh            # Основной скрипт
├── domains.txt           # Список доменов для перенаправления
├── config/
│   └── redsocks.conf     # Конфигурация прокси
├── scripts/
│   └── update_ips.sh     # Скрипт обновления IP
└── logs/                 # Директория логов
     ├── install-*.log
     ├── wan-*.log
     └── redsocks.log
```

## Логирование

Все операции записываются в папку `logs/`. Для мониторинга в реальном времени:

```bash
tail -f logs/redsocks.log
```

## Частые вопросы

### Нет интернет-доступа после настройки
1. Проверьте физическое подключение кабелей
2. Убедитесь в правильности выбора WAN-интерфейса
3. Проверьте настройки прокси в `redsocks.conf`

### Домены не перенаправляются
1. Убедитесь, что домены добавлены в `domains.txt`
2. Выполните принудительное обновление IP:
```bash
sudo ./gateway.sh --update
```

### Ошибки в конфигурации
Проверьте синтаксис файлов:
```bash
redsocks --test -c config/redsocks.conf
```

## Лицензия

MIT License. Подробнее см. в файле [LICENSE](LICENSE).

---

**Разработано**: [Ваше Имя]
**Репозиторий**: https://github.com/yourusername/transparent-proxy-gateway